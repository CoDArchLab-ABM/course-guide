# Loading and preparing simulation results {#analysis-preprocessing}

## ğŸ“Š Analysis Pipeline for Simulation Results

```
ğŸ’¾ Simulation outputs<br/>BehaviorSpace CSV files
        â†“
ğŸ“¥ Import data<br/>R, tidyverse
        â†“
ğŸ§¹ Clean & prepare<br/>Data wrangling, filtering, reshaping
        â†“
ğŸ“ˆ Explore<br/>Descriptive plots, distributions, correlations
        â†“
ğŸ“Š Analyse<br/>Statistical models, sensitivity analysis
        â†“
ğŸ–¼ï¸ Visualise<br/>Publication-ready plots, dashboard
        â†“
ğŸ§© Interpret<br/>Compare with hypotheses, archaeological data
        â†“
ğŸ“˜ Report & share<br/>RMarkdown, GitHub, Zenodo DOI
        â†º
ğŸ” Refine model or experiment design
```

## Setting up our script environment

```{r}
library(ggplot2)
library(readr)
```

```{r}
experiments_path <- "assets/netlogo/experiments/Artificial Anasazi_experiments "
```

```{r}
color_mapping <- c("historical households" = "blue", 
                   "simulation households" = "darkred")
```

## Single run

```{r}
expname <- "experiment single run"
```

Read output:
```{r}
results_single <- readr::read_csv(paste0(experiments_path, expname, "-table.csv"), skip = 6)
```

Plot trajectories of metrics:
```{r}
plot_name <- paste0(experiments_path, expname, "-trajectories.png")

png(plot_name, width = 840, height = 540)

ggplot(results_single) +  
  geom_line(aes(x = `[step]`, y = `historical-total-households`, color = "historical data"),
            linewidth = 1.2) +
  geom_line(aes(x = `[step]`, y = `total-households`, color = "simulation households"),
            linewidth = 1.2) +
  labs(x = "steps", y = "households") +
  scale_color_manual(name = "", values = color_mapping) +
  theme(legend.position = "right")

dev.off()
```

```{r}
knitr::include_graphics(plot_name)
```

## Multiple runs in single configuration

```{r}
expname <- "experiment multiple runs"
```

Read output:
```{r}
results_single <- readr::read_csv(paste0(experiments_path, expname, "-table.csv"), skip = 6)
```

Plot trajectories of metrics:
```{r}
plot_name <- paste0(experiments_path, expname, "-trajectories.png")

png(plot_name, width = 840, height = 540)

ggplot(results_single) +  
  geom_line(aes(x = `[step]`, y = `total-households`, color = `[run number]`, group = `[run number]`),
            linewidth = 1.2) +
  geom_line(aes(x = `[step]`, y = `historical-total-households`), 
            color = color_mapping["historical households"],
            linewidth = 1.2, linetype = 2) +
  labs(x = "steps", y = "households") +
  theme(legend.position = "right")

dev.off()
```

```{r}
knitr::include_graphics(plot_name)
```

## Parameter exploration - regular intervals

### One parameter

```{r}
expname <- "experiment harvest adjustment"
```

Read output:
```{r}
results_harvest_adj <- readr::read_csv(paste0(experiments_path, expname, "-table.csv"), skip = 6)
```

Plot trajectories of metrics:
```{r}
plot_name <- paste0(experiments_path, expname, "-trajectories.png")

png(plot_name, width = 840, height = 540)

ggplot(results_harvest_adj) +  
  geom_line(aes(x = `[step]`, y = `total-households`, color = `harvest-adjustment`, group = `[run number]`),
            linewidth = 1.2) +
  geom_line(aes(x = `[step]`, y = `historical-total-households`), color = "black",
            linewidth = 1.2, linetype = 2) +
  labs(x = "steps", y = "households") +
  theme(legend.position = "right")

dev.off()
```

```{r}
knitr::include_graphics(plot_name)
```

### Two parameter

```{r}
expname <- "experiment harvest adjustment variance"
```

Read output:
```{r}
results_harvest_adj <- readr::read_csv(paste0(experiments_path, expname, "-table.csv"), skip = 6)
```

Plot trajectories of metrics:
```{r}
plot_name <- paste0(experiments_path, expname, "-trajectories.png")

png(plot_name, width = 840, height = 540)

ggplot(results_harvest_adj) +  
  geom_line(aes(x = `[step]`, y = `total-households`, group = `[run number]`),
            color = color_mapping["simulation households"],
            linewidth = 1.2) +
  geom_line(aes(x = `[step]`, y = `historical-total-households`), 
            color = color_mapping["historical households"],
            linewidth = 1.2, linetype = 2) +
  facet_grid(`harvest-adjustment` ~ `harvest-variance`) +
  labs(x = "steps", y = "households") +
  theme(legend.position = "right")

dev.off()
```

```{r}
knitr::include_graphics(plot_name)
```
